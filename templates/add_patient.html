<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Register Patient</title>
  <style>
    :root{
      --accent:#2b8aef;
      --muted:#666;
      --bg:#f6f8fb;
      --card:#ffffff;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:var(--bg); margin:0; padding:24px;}
    .container{max-width:760px;margin:28px auto;padding:20px;background:var(--card);box-shadow:0 6px 18px rgba(20,30,50,0.08);border-radius:10px;}
    h1{margin:0 0 12px;color:var(--accent)}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .form-row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    label{display:block;font-size:0.9rem;margin-bottom:6px}
    input[type="text"], input[type="number"], input[type="tel"], input[type="date"], select, textarea{
      width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:6px;font-size:1rem;
    }
    textarea{min-height:100px;resize:vertical}
    .col-2{flex:1 1 48%}
    .col-full{flex:1 1 100%}
    .actions{display:flex;gap:10px;align-items:center;margin-top:14px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer}
    button.secondary{background:#eef3ff;color:var(--accent);border:1px solid #d6e6ff}
    .error{color:#c62828;font-size:0.9rem;margin-top:6px}
    .success-message {
      color: green;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .otp-display {
      color: var(--accent);
      font-size: 1.1rem;
      margin-bottom: 20px;
    }
    @media (max-width:560px){ .col-2{flex-basis:100%} }
  </style>
</head>
<body>
  <main class="container" aria-labelledby="title">
    <h1 id="title">Register New Patient</h1>
    <p class="lead">Fill patient details. All fields marked with * are required.</p>

    <!-- ✅ Show success message -->
    {% if message %}
      <p class="success-message">{{ message }}</p>
    {% endif %}

    <!-- ✅ Show OTP and Patient ID only if source is patient -->
    {% if source == 'patient' and otp and patient_id %}
      <p class="otp-display">
        Patient ID: <strong>{{ patient_id }}</strong><br>
        Your OTP: <strong>{{ otp }}</strong>
      </p>
    {% endif %}

    <!-- ✅ Dynamically choose correct action URL -->
    <form action="{{ '/admin/add_patient' if source == 'admin' else '/patient/add' }}" method="post">
      <div class="form-row">
        <div class="col-2">
          <label for="name">Full name *</label>
          <input id="name" name="name" type="text" autocomplete="name" required />
        </div>

        <div class="col-2">
          <label for="age">Age *</label>
          <input id="age" name="age" type="number" min="0" max="150" required />
        </div>
      </div>

      <div class="form-row">
        <div class="col-2">
          <label for="gender">Gender *</label>
          <select id="gender" name="gender" required>
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
        </div>

        <div class="col-2">
          <label for="dob">Date of Birth *</label>
          <input id="dob" name="dob" type="date" required />
        </div>
      </div>

      <div class="form-row">
        <div class="col-full">
          <label for="contact">Contact number (10 digits) *</label>
          <input id="contact" name="contact" type="tel" pattern="[0-9]{10}" inputmode="numeric" placeholder="9876543210" required />
        </div>
      </div>

      <div class="form-row">
        <div class="col-full">
          <label for="symptoms">Symptoms / Problem</label>
          <textarea id="symptoms" name="symptoms" placeholder="Describe symptoms..."></textarea>
        </div>
      </div>

      <div class="actions">
        <button type="submit">Register Patient</button>
        <button type="reset" class="secondary">Reset</button>
      </div>
    </form>
  </main>
</body>
</html>
